# 请假系统设计说明

## 一、RESTful 接口说明

   所有的接口都返回JSON格式的数据，其具体形式如下所示，之后对于返回值的描述，仅描述data

   

```
{
    "error_code": 0,       //错误代码，程序产生的错误将与错误代码一一对应，0则无错
    "message": "请求成功",  //错误信息，对于程序错误信息的描述
    "data": []             //用于存储可能被前端需要的返回值，默认为空数组 
}
```

  error_code及其对应的错误原因如下所示

| error_code | reason                         |
| ---------- | ------------------------------ |
| 0          | 无错                           |
| 1          | 注册员工时，工号已经存在       |
| 2          | 注册员工失败                   |
| 3          | 登录时，账号密码输入错误       |
| 4          | 当前没有任何用户在此计算机登录 |
| 11         | 无法获取部门列表               |
| 21         | 创建请假单失败                 |



### 1.注册与登陆

#### 1.1 注册

| 项目         | 属性                 |
| ------------ | -------------------- |
| HTTP请求方法 | POST                 |
| 路由         | api/register         |
| 功能         | 向公司内添加一名员工 |

#####request中应该包含的参数

| 参数        | 类型    | 备注                            |
| ----------- | ------- | ------------------------------- |
| work_number | varchar | 工号，由前端定义长度等信息      |
| name        | varchar | 姓名                            |
| gender      | int     | 性别，0女，1男                  |
| password    | varchar | 密码，由前端定义一些限制        |
| part        | varchar | 部门编号（有其他api提供对照表） |

##### data的描述

```
data:[] // data始终为空，无论注册是否成功
```



#### 1.2 登录

| 项目         | 属性                                   |
| ------------ | -------------------------------------- |
| HTTP请求方法 | POST                                   |
| 路由         | api/login                              |
| 功能         | 在当前计算机上登录员工在请假系统的账户 |

##### request中应该包含的参数

| 参数        | 类型    | 备注                       |
| ----------- | ------- | -------------------------- |
| work_number | varchar | 工号，由前端定义长度等信息 |
| password    | varchar | 密码，由前端定义一些限制   |

#####data的描述

```json
data:[] // data始终为空，无论注册是否成功
```



#### 1.3 登录状态

| 项目         | 属性                           |
| ------------ | ------------------------------ |
| HTTP请求方法 | GET                            |
| 路由         | api/status                     |
| 功能         | 获取登陆在当前计算机上的用户id |

##### data的描述

```
data:[
    'user': int     //当前用户的id
]
```



### 2.部门

####2.1部门列表

| 项目         | 属性                                   |
| ------------ | -------------------------------------- |
| HTTP请求方法 | GET                                    |
| 路由         | api/parts                              |
| 功能         | 获取公司内所有部门的id，以及对应的名称 |

##### data的描述

```
data:[
    [
        'id' ：int // 部门的id
        'name' : string // 部门的名称
    ],
    [……]
]
```



### 3.请假

#### 3.1提交请假申请

| 项目         | 属性             |
| ------------ | ---------------- |
| HTTP请求方法 | POST             |
| 路由         | api/apply        |
| 功能         | 添加一条请假申请 |

##### request中应该包含的参数

| 参数       | 类型    | 备注                                              |
| ---------- | ------- | ------------------------------------------------- |
| reason     | varchar | 请假理由                                          |
| start_time | varchar | 开始时间，格式为严格的YYYY-MM-DD                  |
| length     | int     | 假期时间，单位天。                                |
| type       | int     | 默认0是无薪假期，带薪休假（计算剩余天数）暂不支持 |

##### data的描述

```
data:[] // data始终为空，无论注册是否成功
```



#### 3.2 自己的请假单

| 项目         | 属性                         |
| ------------ | ---------------------------- |
| HTTP请求方法 | GET                          |
| 路由         | api/apply/self               |
| 功能         | 获取自己曾提交过的所有请假单 |

##### data的描述

```
data:[
    [
        'part' : varchar //部门名称
        'type' : varchar, //假期类型
        'start_time' :varchar //YYYY-MM-DD
        'length' :int //假期长度
        'reason' :varchar, //请假理由
        'part_agree' :int, //部长是否批过假
        'sub_manager_agree' :int, //副总经理是否批过假
        'manager_agree' :int,     //总经理是否批过假
        'ban' :int, //是否被某人拒绝假期
        'pass' :int //申请是否通过
    ],
    [……]
]
```



#### 3.3 可以操作的请假单

| 项目         | 属性                   |
| ------------ | ---------------------- |
| HTTP请求方法 | GET                    |
| 路由         | api/apply/power        |
| 功能         | 获取自己可以审核的假期 |

##### data的描述

```
data:[
    [
        'employee' : varchar // 员工姓名
        'part' : varchar //部门名称
        'type' : varchar, //假期类型
        'start_time' :varchar //YYYY-MM-DD
        'length' :int //假期长度
        'reason' :varchar, //请假理由
        'part_agree' :int, //部长是否批过假
        'sub_manager_agree' :int, //副总经理是否批过假
        'manager_agree' :int,     //总经理是否批过假
        'ban' :int, //是否被某人拒绝假期
        'pass' :int //申请是否通过
    ],
    [……]
]
```



#### 3.5 可以操作的请假单

| 项目         | 属性                     |
| ------------ | ------------------------ |
| HTTP请求方法 | GET                      |
| 路由         | api/apply/current        |
| 功能         | 查看今日请假的人的请假单 |

##### data的描述

```
data:[
    [
        'id' : int 这条申请的id，用来传给ban/agree按钮
        'employee' : varchar // 员工姓名
        'part' : varchar //部门名称
        'type' : varchar, //假期类型
        'start_time' :varchar //YYYY-MM-DD
        'length' :int //假期长度
        'reason' :varchar, //请假理由
        'part_agree' :int, //部长是否批过假
        'sub_manager_agree' :int, //副总经理是否批过假
        'manager_agree' :int,     //总经理是否批过假
        'ban' :int, //是否被某人拒绝假期
        'pass' :int //申请是否通过
    ],
    [……]
]
```



#### 3.6 同意请假申请

| 项目         | 属性                 |
| ------------ | -------------------- |
| HTTP请求方法 | POST                 |
| 路由         | api/apply/agree/{id} |
| 功能         | 同意某申请           |

##### request中应该包含的参数

| 参数 | 类型 |      |
| ---- | ---- | ---- |
|      |      |      |

##### data的描述

```
data:[] // data始终为空，无论操作是否成功
```



#### 3.7 拒绝请假申请

| 项目         | 属性               |
| ------------ | ------------------ |
| HTTP请求方法 | POST               |
| 路由         | api/apply/ban/{id} |
| 功能         | 拒绝某申请         |

##### request中应该包含的参数

| 参数 | 类型 |      |
| ---- | ---- | ---- |
|      |      |      |

##### data的描述

```
data:[] // data始终为空，无论操作是否成功
```

